
version: v1
kind: kubernetes
application: istio_deploy
targets:
  staging:
    account: staging-2
    namespace: borealis-dev
    strategy: myCanary
  production:
    account: staging-2
    namespace: borealis-prod
    strategy: myCanary

manifests:
  - path: istio/nginx_deployment.yml
  - path: istio/istio_config.yaml
  - path: istio/nginx_service.yaml

strategies:
  myCanary:
    canary:
      steps:
        - setWeight:
            weight: 25
        - pause:
            untilApproved: true

trafficManagement:
  - targets: [staging]
    istio:
      - virtualService:
          name: istio-sample
        destinationRule:
          name: istio-sample